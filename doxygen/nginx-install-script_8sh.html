<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Nginx Install Script: Référence du fichier nginx-install-script.sh</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Nginx Install Script
   </div>
   <div id="projectbrief">Script pour installer et configurer Nginx de manière offline</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Généré par Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Recherche','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Recherche');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Fonctions</a>  </div>
  <div class="headertitle"><div class="title">Référence du fichier nginx-install-script.sh</div></div>
</div><!--header-->
<div class="contents">

<p>Script d'installation d'un serveur de partage de fichiers (IOC).  
<a href="#details">Plus de détails...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Fonctions</h2></td></tr>
<tr class="memitem:ab967e32522c84b23a11145d9e7d8c6d5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nginx-install-script_8sh.html#ab967e32522c84b23a11145d9e7d8c6d5">create_restricted_user</a> ()</td></tr>
<tr class="memdesc:ab967e32522c84b23a11145d9e7d8c6d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Permet de créer un utilisateur avec le moindre privilège.  <a href="nginx-install-script_8sh.html#ab967e32522c84b23a11145d9e7d8c6d5">Plus de détails...</a><br /></td></tr>
<tr class="separator:ab967e32522c84b23a11145d9e7d8c6d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36ea95ac049da93099d1b007a54a71c6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nginx-install-script_8sh.html#a36ea95ac049da93099d1b007a54a71c6">https_configuration</a> ()</td></tr>
<tr class="memdesc:a36ea95ac049da93099d1b007a54a71c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Étapes détaillées :  <a href="nginx-install-script_8sh.html#a36ea95ac049da93099d1b007a54a71c6">Plus de détails...</a><br /></td></tr>
<tr class="separator:a36ea95ac049da93099d1b007a54a71c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a840763b925d20ad3099d2f2f08b5b34f"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nginx-install-script_8sh.html#a840763b925d20ad3099d2f2f08b5b34f">create_log_file</a> ()</td></tr>
<tr class="memdesc:a840763b925d20ad3099d2f2f08b5b34f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Permet de créer des fichiers de logs.  <a href="nginx-install-script_8sh.html#a840763b925d20ad3099d2f2f08b5b34f">Plus de détails...</a><br /></td></tr>
<tr class="separator:a840763b925d20ad3099d2f2f08b5b34f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f51de5373168641768b0691fbdddb48"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nginx-install-script_8sh.html#a1f51de5373168641768b0691fbdddb48">log_message</a> ()</td></tr>
<tr class="memdesc:a1f51de5373168641768b0691fbdddb48"><td class="mdescLeft">&#160;</td><td class="mdescRight">Permet de créer des messages dans les fichiers de logs.  <a href="nginx-install-script_8sh.html#a1f51de5373168641768b0691fbdddb48">Plus de détails...</a><br /></td></tr>
<tr class="separator:a1f51de5373168641768b0691fbdddb48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6c46c12d3cf186a52b5a5576525ebbf0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nginx-install-script_8sh.html#a6c46c12d3cf186a52b5a5576525ebbf0">ufw_allow</a> ()</td></tr>
<tr class="memdesc:a6c46c12d3cf186a52b5a5576525ebbf0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Permet de mettre en place des règles de pare-feu.  <a href="nginx-install-script_8sh.html#a6c46c12d3cf186a52b5a5576525ebbf0">Plus de détails...</a><br /></td></tr>
<tr class="separator:a6c46c12d3cf186a52b5a5576525ebbf0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a751eebb59a5cfd37ced0cbe178ed5496"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nginx-install-script_8sh.html#a751eebb59a5cfd37ced0cbe178ed5496">restrict_user</a> ()</td></tr>
<tr class="memdesc:a751eebb59a5cfd37ced0cbe178ed5496"><td class="mdescLeft">&#160;</td><td class="mdescRight">Permet de cloisonner des dossiers.  <a href="nginx-install-script_8sh.html#a751eebb59a5cfd37ced0cbe178ed5496">Plus de détails...</a><br /></td></tr>
<tr class="separator:a751eebb59a5cfd37ced0cbe178ed5496"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affd099ce07b3da2cd0f082fbac393c30"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nginx-install-script_8sh.html#affd099ce07b3da2cd0f082fbac393c30">check_dependency</a> ()</td></tr>
<tr class="memdesc:affd099ce07b3da2cd0f082fbac393c30"><td class="mdescLeft">&#160;</td><td class="mdescRight">Vérifie si un paquet est installé sur le système.  <a href="nginx-install-script_8sh.html#affd099ce07b3da2cd0f082fbac393c30">Plus de détails...</a><br /></td></tr>
<tr class="separator:affd099ce07b3da2cd0f082fbac393c30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad26fd8e2afc7b13701366e93d515bb71"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nginx-install-script_8sh.html#ad26fd8e2afc7b13701366e93d515bb71">select_path</a> ()</td></tr>
<tr class="memdesc:ad26fd8e2afc7b13701366e93d515bb71"><td class="mdescLeft">&#160;</td><td class="mdescRight">Permet de sélectionner un fichier ou un dossier avec Zenity.  <a href="nginx-install-script_8sh.html#ad26fd8e2afc7b13701366e93d515bb71">Plus de détails...</a><br /></td></tr>
<tr class="separator:ad26fd8e2afc7b13701366e93d515bb71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc4ccb09d7c0fd736b925eed7a4390f5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nginx-install-script_8sh.html#abc4ccb09d7c0fd736b925eed7a4390f5">get_php_version</a> ()</td></tr>
<tr class="memdesc:abc4ccb09d7c0fd736b925eed7a4390f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Permet de récupérer la version de PHP.  <a href="nginx-install-script_8sh.html#abc4ccb09d7c0fd736b925eed7a4390f5">Plus de détails...</a><br /></td></tr>
<tr class="separator:abc4ccb09d7c0fd736b925eed7a4390f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7addd0944494b69a4cf40c8313199012"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nginx-install-script_8sh.html#a7addd0944494b69a4cf40c8313199012">installation</a> ()</td></tr>
<tr class="memdesc:a7addd0944494b69a4cf40c8313199012"><td class="mdescLeft">&#160;</td><td class="mdescRight">Permet d'installer nginx'.  <a href="nginx-install-script_8sh.html#a7addd0944494b69a4cf40c8313199012">Plus de détails...</a><br /></td></tr>
<tr class="separator:a7addd0944494b69a4cf40c8313199012"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3533b46173e5420e2ebf1986ac72ded5"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nginx-install-script_8sh.html#a3533b46173e5420e2ebf1986ac72ded5">configuration</a> ()</td></tr>
<tr class="memdesc:a3533b46173e5420e2ebf1986ac72ded5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure Nginx pour un nouveau site avec SSL et PHP-FPM.  <a href="nginx-install-script_8sh.html#a3533b46173e5420e2ebf1986ac72ded5">Plus de détails...</a><br /></td></tr>
<tr class="separator:a3533b46173e5420e2ebf1986ac72ded5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0505f513d3668b8cc6799cdc9593a98b"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nginx-install-script_8sh.html#a0505f513d3668b8cc6799cdc9593a98b">share_file_folder</a> ()</td></tr>
<tr class="memdesc:a0505f513d3668b8cc6799cdc9593a98b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure Nginx pour un nouveau site avec SSL et PHP-FPM.  <a href="nginx-install-script_8sh.html#a0505f513d3668b8cc6799cdc9593a98b">Plus de détails...</a><br /></td></tr>
<tr class="separator:a0505f513d3668b8cc6799cdc9593a98b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad98d4a4c9376b6805c1772a5a0be4f6a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nginx-install-script_8sh.html#ad98d4a4c9376b6805c1772a5a0be4f6a">delete_configuration</a> ()</td></tr>
<tr class="memdesc:ad98d4a4c9376b6805c1772a5a0be4f6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Permet de supprimer la configuration.  <a href="nginx-install-script_8sh.html#ad98d4a4c9376b6805c1772a5a0be4f6a">Plus de détails...</a><br /></td></tr>
<tr class="separator:ad98d4a4c9376b6805c1772a5a0be4f6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Description détaillée</h2>
<div class="textblock"><p >Script d'installation d'un serveur de partage de fichiers (IOC). </p>
</div><h2 class="groupheader">Documentation des fonctions</h2>
<a id="affd099ce07b3da2cd0f082fbac393c30" name="affd099ce07b3da2cd0f082fbac393c30"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affd099ce07b3da2cd0f082fbac393c30">&#9670;&nbsp;</a></span>check_dependency()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">check_dependency </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Vérifie si un paquet est installé sur le système. </p>
<p >Cette fonction vérifie si un paquet spécifique est installé sur le système à l'aide de la commande <code>dpkg -s</code>. Si le paquet n'est pas installé, elle :</p><ul>
<li>Enregistre un message d'erreur dans le fichier de logs indiquant que le paquet est manquant et qu'une installation est requise.</li>
<li>Affiche un message d'erreur à l'utilisateur dans le terminal, précisant que le paquet n'est pas installé et qu'il doit être installé pour continuer.</li>
<li>Arrête l'exécution du script en renvoyant un code d'erreur (exit 1). Si le paquet est installé, elle :</li>
<li>Enregistre un message d'information dans le fichier de logs pour indiquer que le paquet est installé avec succès.</li>
</ul>
<p >Prend un paramètre : le nom du paquet à vérifier (ex. <code>apt</code>, <code>curl</code>, <code>git</code>). </p>

</div>
</div>
<a id="a3533b46173e5420e2ebf1986ac72ded5" name="a3533b46173e5420e2ebf1986ac72ded5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3533b46173e5420e2ebf1986ac72ded5">&#9670;&nbsp;</a></span>configuration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">configuration </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configure Nginx pour un nouveau site avec SSL et PHP-FPM. </p>
<p >Cette fonction configure Nginx pour un site web spécifié par l'utilisateur. Elle exécute plusieurs étapes pour préparer le site, y compris :</p><ul>
<li>Vérification de l'installation de Nginx. Si Nginx n'est pas installé, l'installation est requise.</li>
<li>Demande à l'utilisateur de spécifier un nom de site et vérifie si une configuration pour ce site existe déjà.</li>
<li>Création d'un utilisateur restreint pour Nginx et préparation du répertoire du site.</li>
<li>Création de fichiers PHP d'exemple pour l'index et les erreurs 404.</li>
<li>Génération d'un certificat SSL auto-signé pour le site.</li>
<li>Configuration de Nginx pour utiliser SSL avec le site, ainsi que PHP-FPM.</li>
<li>Vérification de la configuration Nginx et rechargement du service Nginx et PHP-FPM.</li>
<li>Activation du site en ajoutant un lien symbolique dans <code>sites-enabled</code> et rechargement des services.</li>
</ul>
<p >La fonction échoue et quitte si une erreur se produit à n'importe quelle étape, et elle indique l'erreur à l'utilisateur via une boîte de dialogue <code>whiptail</code>.</p>
<p >Prend un paramètre :</p><ul>
<li>Aucun paramètre d'entrée n'est requis pour cette fonction. </li>
</ul>

</div>
</div>
<a id="a840763b925d20ad3099d2f2f08b5b34f" name="a840763b925d20ad3099d2f2f08b5b34f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a840763b925d20ad3099d2f2f08b5b34f">&#9670;&nbsp;</a></span>create_log_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">create_log_file </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Permet de créer des fichiers de logs. </p>
<p >Créer des fichiers de logs </p>

</div>
</div>
<a id="ab967e32522c84b23a11145d9e7d8c6d5" name="ab967e32522c84b23a11145d9e7d8c6d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab967e32522c84b23a11145d9e7d8c6d5">&#9670;&nbsp;</a></span>create_restricted_user()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">create_restricted_user </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Permet de créer un utilisateur avec le moindre privilège. </p>
<p >Étapes détaillées :</p><ol type="1">
<li><b>Vérification des paramètres</b> : Vérifie que les deux arguments (nom d'utilisateur et nom de groupe) sont fournis. Si ce n'est pas le cas, un message d'erreur est affiché et la fonction s'arrête.</li>
<li><b>Vérification de l'existence du groupe</b> : Vérifie si le groupe spécifié existe. Si le groupe n'existe pas, il est créé à l'aide de la commande <code>groupadd</code>. Si le groupe existe déjà, un message d'information est enregistré.</li>
<li><b>Vérification de l'existence de l'utilisateur</b> : Vérifie si l'utilisateur existe déjà. Si l'utilisateur existe, aucun changement n'est effectué et un message d'information est enregistré.</li>
<li><b>Vérification et création du groupe de l'utilisateur</b> : Si le groupe de l'utilisateur n'existe pas, il est créé à l'aide de la commande <code>groupadd</code>. Si le groupe existe déjà, un message d'information est enregistré.</li>
<li><b>Création de l'utilisateur</b> : Crée un utilisateur système sans répertoire personnel et sans mot de passe initial en utilisant la commande <code>adduser</code>. Si la création échoue, un message d'erreur est enregistré et la fonction s'arrête.</li>
<li><b>Ajout du mot de passe</b> : Le mot de passe est ajouté à l'utilisateur via la commande <code>passwd</code>.</li>
<li><b>Restriction de l'accès shell</b> : L'accès au shell de l'utilisateur est interdit en utilisant <code>usermod -s /usr/sbin/nologin</code>.</li>
<li><b>Ajout de l'utilisateur au groupe</b> : L'utilisateur est ajouté au groupe spécifié avec <code>usermod -aG</code> et également à son propre groupe. Un message d'information est enregistré à chaque étape.</li>
<li><b>Gestion des logs</b> : À chaque étape du processus, des messages d'information ou d'erreur sont enregistrés dans les logs pour suivre le déroulement de la création et des actions réalisées.</li>
<li><b>Résultat final</b> : La fonction termine en enregistrant un message de succès dans les logs indiquant que l'utilisateur a été créé et restreint avec succès.</li>
</ol>
<dl class="section version"><dt>Version</dt><dd>1.0 </dd></dl>
<dl class="section date"><dt>Date</dt><dd>2025-03-25 </dd></dl>
<dl class="section author"><dt>Auteur</dt><dd>ORAIN Enzo | GUENIFET Nathan</dd></dl>
<p>La fonction <a class="el" href="nginx-install-script_8sh.html#ab967e32522c84b23a11145d9e7d8c6d5" title="Permet de créer un utilisateur avec le moindre privilège.">create_restricted_user()</a> permet de créer un utilisateur système avec des restrictions d'accès shell, l'ajoute à un groupe spécifique, et effectue les vérifications nécessaires pour s'assurer que les groupes et utilisateurs existent avant leur création. Elle gère également l'ajout du mot de passe et des restrictions d'accès à l'utilisateur. </p>

</div>
</div>
<a id="ad98d4a4c9376b6805c1772a5a0be4f6a" name="ad98d4a4c9376b6805c1772a5a0be4f6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad98d4a4c9376b6805c1772a5a0be4f6a">&#9670;&nbsp;</a></span>delete_configuration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">delete_configuration </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Permet de supprimer la configuration. </p>
<p >Cette fonction effectue une suppression complète des configurations liées à Nginx et PHP-FPM pour un site donné. Elle arrête les services PHP-FPM et Nginx, supprime les fichiers de configuration, restaure les fichiers de configuration par défaut pour PHP-FPM et Nginx, et supprime les utilisateurs et groupes associés.</p>
<p >Étapes effectuées par la fonction :</p><ol type="1">
<li><b>Récupération de la version PHP</b> : La version PHP actuelle est récupérée à l'aide de la fonction <code><a class="el" href="nginx-install-script_8sh.html#abc4ccb09d7c0fd736b925eed7a4390f5" title="Permet de récupérer la version de PHP.">get_php_version()</a></code>.</li>
<li><b>Arrêt des services</b> : Les services PHP-FPM et Nginx sont arrêtés pour éviter toute interférence pendant la suppression.</li>
<li><b>Suppression des fichiers de configuration</b> :<ul>
<li>Suppression des fichiers et répertoires associés à Nginx sous <code>/var/www/</code>, <code>/etc/nginx/sites-available/</code>, <code>/etc/nginx/sites-enabled/</code>, et d'autres répertoires liés.</li>
<li>Restauration du fichier de configuration <code>nginx.conf</code> à partir de sa sauvegarde (si disponible).</li>
<li>Suppression des fichiers SSL générés pour le site.</li>
</ul>
</li>
<li><b>Restauration de la configuration PHP-FPM</b> : La configuration du pool PHP-FPM est restaurée à partir de la sauvegarde précédente.</li>
<li><b>Suppression de l'utilisateur et des groupes</b> : L'utilisateur <code>nginx_user</code> et les groupes <code>nginx_user</code> et <code>nginx</code> sont supprimés.</li>
<li><b>Redémarrage des services</b> : Les services PHP-FPM et Nginx sont redémarrés après la suppression des configurations.</li>
</ol>
<p >Cette fonction est utile pour réinitialiser ou nettoyer une configuration Nginx et PHP-FPM après avoir supprimé un site web.</p>
<p >Paramètre :</p><ul>
<li>Aucun paramètre d'entrée n'est requis pour cette fonction. </li>
</ul>

</div>
</div>
<a id="abc4ccb09d7c0fd736b925eed7a4390f5" name="abc4ccb09d7c0fd736b925eed7a4390f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc4ccb09d7c0fd736b925eed7a4390f5">&#9670;&nbsp;</a></span>get_php_version()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">get_php_version </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Permet de récupérer la version de PHP. </p>
<p >Cette fonction récupère la version principale de PHP installée sur le système en utilisant la commande <code>php -v</code> et en extrayant la version majeure et mineure. Elle :</p><ul>
<li>Exécute la commande <code>php -v</code> pour obtenir les informations sur la version de PHP.</li>
<li>Utilise <code>awk</code> pour extraire la version majeure et mineure (par exemple, 7.4 pour PHP 7.4.x).</li>
<li>Si la version de PHP ne peut pas être récupérée, un message d'erreur est enregistré dans le journal et la fonction retourne 1.</li>
<li>Si la version est récupérée avec succès, elle est affichée.</li>
</ul>
<p >Paramètre :</p><ul>
<li>Aucun paramètre d'entrée n'est requis pour cette fonction. </li>
</ul>

</div>
</div>
<a id="a36ea95ac049da93099d1b007a54a71c6" name="a36ea95ac049da93099d1b007a54a71c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36ea95ac049da93099d1b007a54a71c6">&#9670;&nbsp;</a></span>https_configuration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">https_configuration </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Étapes détaillées : </p>
<p >Permet de mettre en place du https pour chiffrer la communication.</p>
<ol type="1">
<li><b>Vérification des paramètres</b> : La fonction vérifie que l'argument (nom du site) est bien fourni. Si ce n'est pas le cas, elle affiche un message d'erreur et retourne une erreur.</li>
<li><b>Création de la configuration HTTPS</b> : La fonction génère un fichier de configuration Nginx pour le site dans <code>/etc/nginx/sites-available/</code> avec un nom de fichier basé sur le nom du site fourni (<code>$website_name.conf</code>). <br  />
</li>
<li><b>Serveur HTTP (port 8042)</b> : Un serveur HTTP est configuré pour écouter sur le port 8042. Ce serveur redirige toutes les requêtes HTTP vers HTTPS en utilisant une redirection permanente (code 301) vers le port 8043 (HTTPS). <br  />
</li>
<li><b>Serveur HTTPS (port 8043)</b> : Un serveur HTTPS est configuré pour écouter sur le port 8043, avec SSL activé :<ul>
<li>Utilisation des protocoles SSL/TLS modernes (TLSv1.2 et TLSv1.3).</li>
<li>Le certificat SSL et la clé privée sont définis (les fichiers <code>.crt</code> et <code>.key</code> sont utilisés pour l'activation du HTTPS).</li>
<li>Le serveur écoute sur les adresses IP spécifiées (localhost, 127.0.0.1, et l'adresse IP locale du serveur).</li>
<li>Le répertoire racine est défini sur <code>/var/www/$website_name</code>, et le fichier <code>index.php</code> est utilisé comme fichier index.</li>
</ul>
</li>
<li><b>Configuration de la gestion des requêtes</b> :<ul>
<li><b>Location / :</b> Permet de servir les fichiers du site, en activant l'option <code>autoindex on</code> pour permettre l'affichage des répertoires. En cas de fichier introuvable, une erreur 404 est renvoyée.</li>
<li><b>Location ~ .php$ :</b> Permet de traiter les fichiers PHP avec <code>fastcgi</code> en envoyant les requêtes au serveur PHP-FPM.</li>
<li><b>Location ~ /.ht :</b> Refuse l'accès aux fichiers commençant par <code>.ht</code> pour des raisons de sécurité.</li>
</ul>
</li>
<li><b>Gestion des erreurs</b> :<ul>
<li>La fonction définit des pages d'erreur personnalisées pour les erreurs HTTP 404 et 50x (erreurs serveur).</li>
<li>En cas d'erreur 404, une page personnalisée <code>/404.html</code> est retournée.</li>
<li>Les erreurs 500, 502, 503 et 504 sont redirigées vers une page <code>/50x.html</code> dans le répertoire du site.</li>
</ul>
</li>
<li><b>Finalisation</b> : Une fois la configuration générée, elle est stockée dans le fichier <code>/etc/nginx/sites-available/$website_name.conf</code>.</li>
</ol>
<p >La fonction <a class="el" href="nginx-install-script_8sh.html#a36ea95ac049da93099d1b007a54a71c6" title="Étapes détaillées :">https_configuration()</a> configure un serveur web sécurisé HTTPS pour un site web spécifique. Elle crée un fichier de configuration Nginx pour ce site avec une redirection de HTTP vers HTTPS et la configuration d'un serveur HTTPS. Elle prend un argument : le nom du site (utilisé pour générer les configurations et les chemins associés). </p>

</div>
</div>
<a id="a7addd0944494b69a4cf40c8313199012" name="a7addd0944494b69a4cf40c8313199012"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7addd0944494b69a4cf40c8313199012">&#9670;&nbsp;</a></span>installation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">installation </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Permet d'installer nginx'. </p>
<p >Cette fonction installe Nginx à partir d'une archive tar.gz en suivant plusieurs étapes. Elle :</p><ul>
<li>Demande à l'utilisateur de sélectionner une archive tar.gz contenant Nginx à l'aide de la fonction <code>select_path</code>.</li>
<li>Crée un répertoire temporaire pour extraire l'archive.</li>
<li>Extrait l'archive tar.gz dans le répertoire temporaire.</li>
<li>Configure Nginx en utilisant la commande <code>./configure</code> avec des options prédéfinies pour le chemin des fichiers de configuration et des logs.</li>
<li>Compile et installe Nginx avec <code>make</code> et <code>make install</code>.</li>
<li>Crée un service systemd pour démarrer et gérer Nginx comme un service.</li>
<li>Active et démarre le service Nginx.</li>
</ul>
<p >La fonction s'arrête en cas d'erreur à n'importe quelle étape (sélection de fichier, extraction, configuration, compilation, installation, ou démarrage du service).</p>
<p >Prend un paramètre :</p><ul>
<li>Aucun paramètre d'entrée n'est requis pour cette fonction. </li>
</ul>

</div>
</div>
<a id="a1f51de5373168641768b0691fbdddb48" name="a1f51de5373168641768b0691fbdddb48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f51de5373168641768b0691fbdddb48">&#9670;&nbsp;</a></span>log_message()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">log_message </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Permet de créer des messages dans les fichiers de logs. </p>
<p >Elle écrit ensuite une ligne dans le fichier de logs défini par la variable <code>$LOGFILE</code>, en y ajoutant un horodatage et le niveau du message pour faciliter le suivi des événements. Format de la ligne enregistrée dans le fichier de log : YYYY-MM-DD HH:MM:SS - [NIVEAU] Message Exemple d'utilisation : log_message "Info" "Création de l'utilisateur terminée avec succès." Prérequis :</p><ul>
<li>La variable d'environnement <code>LOGFILE</code> doit être définie au préalable (par exemple : <code>LOGFILE="/var/log/script.log"</code>).</li>
</ul>
<p >La fonction <a class="el" href="nginx-install-script_8sh.html#a1f51de5373168641768b0691fbdddb48" title="Permet de créer des messages dans les fichiers de logs.">log_message()</a> permet de centraliser l'écriture des messages dans un fichier de log. Elle prend deux arguments :</p><ul>
<li>le <b>niveau de log</b> (par exemple : "Info", "Warning", "Error"),</li>
<li>et le <b>message</b> à consigner. </li>
</ul>

</div>
</div>
<a id="a751eebb59a5cfd37ced0cbe178ed5496" name="a751eebb59a5cfd37ced0cbe178ed5496"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a751eebb59a5cfd37ced0cbe178ed5496">&#9670;&nbsp;</a></span>restrict_user()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">restrict_user </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Permet de cloisonner des dossiers. </p>
<p >Cette fonction applique des restrictions d'accès et ajuste les permissions sur différents répertoires critiques du serveur pour sécuriser l’environnement d’un utilisateur spécifique. Elle :</p><ul>
<li>Change le propriétaire et les droits du dossier /var/www pour limiter l'accès.</li>
<li>Renforce les permissions sur les fichiers de configuration Nginx.</li>
<li>Permet à l'utilisateur désigné d'accéder uniquement aux répertoires nécessaires.</li>
<li>Restreint l'accès aux logs de Nginx à un groupe spécifique.</li>
<li>Configure correctement les permissions sur le socket PHP-FPM.</li>
<li>Donne un accès restreint et sécurisé au répertoire web du site ainsi qu’au sous-dossier "partage".</li>
</ul>
<p >Prend deux paramètres : le nom d'utilisateur et le groupe associé. </p>

</div>
</div>
<a id="ad26fd8e2afc7b13701366e93d515bb71" name="ad26fd8e2afc7b13701366e93d515bb71"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad26fd8e2afc7b13701366e93d515bb71">&#9670;&nbsp;</a></span>select_path()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">select_path </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Permet de sélectionner un fichier ou un dossier avec Zenity. </p>
<p >Cette fonction ouvre une interface graphique via Zenity permettant à l'utilisateur de sélectionner un fichier ou un répertoire. Elle :</p><ul>
<li>Demande à l'utilisateur de choisir entre un fichier ou un répertoire.</li>
<li>Si un mode de sélection n'est pas précisé, la fonction l'invite à choisir le type via une boîte de dialogue Zenity.</li>
<li>Permet à l'utilisateur de filtrer les fichiers sélectionnés par extension(s) (par exemple : .txt, .jpg).</li>
<li>Exclut certains chemins d'accès définis (ex. : répertoires ou fichiers interdits) et empêche leur sélection.</li>
<li>Vérifie que le fichier sélectionné possède une extension valide si des extensions sont spécifiées.</li>
<li>Permet à l'utilisateur de confirmer ou d'annuler sa sélection. Si la sélection est annulée ou invalide, une nouvelle demande est effectuée.</li>
</ul>
<p >Paramètres :</p><ul>
<li>$1 : Le titre de la fenêtre de sélection (par défaut : "Sélectionnez un élément").</li>
<li>$2 : Le mode de sélection (peut être vide, "file" pour un fichier, ou "directory" pour un répertoire).</li>
<li>$3 : Liste des extensions de fichiers attendues, séparées par des espaces (par défaut : aucune restriction).</li>
<li>$4 : Liste des chemins à exclure de la sélection, séparés par des espaces. </li>
</ul>

</div>
</div>
<a id="a0505f513d3668b8cc6799cdc9593a98b" name="a0505f513d3668b8cc6799cdc9593a98b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0505f513d3668b8cc6799cdc9593a98b">&#9670;&nbsp;</a></span>share_file_folder()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">share_file_folder </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configure Nginx pour un nouveau site avec SSL et PHP-FPM. </p>
<p >Cette fonction permet à l'utilisateur de sélectionner un ou plusieurs sites disposant d'un dossier 'partage', puis de choisir des fichiers ou dossiers à copier dans le répertoire 'partage' du site sélectionné. Si aucun dossier 'partage' n'est trouvé, la fonction retourne une erreur. Si l'utilisateur annule une des étapes, la fonction retourne également une erreur.</p>
<p >Fonctionnement détaillé :</p><ul>
<li>Recherche des sites ayant un dossier 'partage' dans /var/www/.</li>
<li>Affiche une liste de sites à l'aide de <code>whiptail</code> pour que l'utilisateur sélectionne un ou plusieurs sites.</li>
<li>Permet à l'utilisateur de sélectionner des fichiers ou dossiers à partager.</li>
<li>Copie les fichiers ou dossiers sélectionnés dans le dossier 'partage' du site choisi.</li>
<li>Vérifie si la copie a été réussie et affiche un message pour chaque fichier/dossier.</li>
</ul>
<p >Cette fonction génère des logs d'information et d'erreur pour chaque étape et présente des boîtes de dialogue à l'utilisateur en cas d'erreur.</p>
<p >Paramètre :</p><ul>
<li>Aucun paramètre d'entrée n'est requis pour cette fonction. </li>
</ul>

</div>
</div>
<a id="a6c46c12d3cf186a52b5a5576525ebbf0" name="a6c46c12d3cf186a52b5a5576525ebbf0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6c46c12d3cf186a52b5a5576525ebbf0">&#9670;&nbsp;</a></span>ufw_allow()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ufw_allow </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Permet de mettre en place des règles de pare-feu. </p>
<p >La fonction <a class="el" href="nginx-install-script_8sh.html#a6c46c12d3cf186a52b5a5576525ebbf0" title="Permet de mettre en place des règles de pare-feu.">ufw_allow()</a> permet d'autoriser certaines IP à accéder aux ports 8042 et 8043 </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Généré par&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
